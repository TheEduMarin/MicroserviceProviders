using Dapper; using MySql.Data.MySqlClient; using FluentResults; using Providers.Domain; namespace Providers.Infrastructure; public class ProviderRepository:IProviderRepository{ string cs; public ProviderRepository(string c)=>cs=c; MySqlConnection Conn()=>new(cs); public async Task<Result<Provider>> CreateAsync(Provider p){ using var c=Conn(); await c.OpenAsync(); p.Id=await c.ExecuteScalarAsync<int>("INSERT INTO providers(first_name,last_name,nit,address,email,phone) VALUES(@FirstName,@LastName,@Nit,@Address,@Email,@Phone); SELECT LAST_INSERT_ID();",p); return p;} public async Task<Result<Provider>> UpdateAsync(Provider p){ using var c=Conn(); await c.OpenAsync(); await c.ExecuteAsync("UPDATE providers SET first_name=@FirstName,last_name=@LastName,nit=@Nit,address=@Address,email=@Email,phone=@Phone WHERE id=@Id",p); return p;} public async Task<Result<Provider?>> GetAsync(int id){ using var c=Conn(); await c.OpenAsync(); var r=await c.QuerySingleOrDefaultAsync<Provider>("SELECT * FROM providers WHERE id=@id", new{id}); return r;} public async Task<Result<IEnumerable<Provider>>> ListAsync(){ using var c=Conn(); await c.OpenAsync(); var r=await c.QueryAsync<Provider>("SELECT * FROM providers WHERE is_deleted=0"); return r;} public async Task<Result<bool>> DeleteAsync(int id){ using var c=Conn(); await c.OpenAsync(); await c.ExecuteAsync("UPDATE providers SET is_deleted=1 WHERE id=@id", new{id}); return true;} }